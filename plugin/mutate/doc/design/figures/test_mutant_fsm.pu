@startuml
hide empty description

[*] -> Initialize

Initialize -> SanityCheck

SanityCheck --> Error : failed
SanityCheck --> ParseStdin : fromStdin
SanityCheck -> PreCompileSut

ParseStdin -> PreCompileSut

PreCompileSut --> Error : failed
PreCompileSut --> FindTestCmds : hasTestCmdDir
PreCompileSut --> ChooseMode

FindTestCmds -> ChooseMode

ChooseMode --> AnalyzeTestCmdForTestCase : hasAnalyzer
ChooseMode --> PullRequest : hasConstraint
ChooseMode --> CheckMutantsLeft

PullRequest -> CheckMutantsLeft

AnalyzeTestCmdForTestCase --> UpdateAndResetAliveMutants

UpdateAndResetAliveMutants --> CheckMutantsLeft

UpdateTimeout --> OverloadCheck

OverloadCheck --> CheckRuntime : sleep
OverloadCheck --> Done : halt
OverloadCheck --> ContCheckTestSuite : ok

ContCheckTestSuite --> Cleanup : ok
ContCheckTestSuite --> Error : fail

Cleanup --> NextSchemata
Cleanup --> NextPullRequestMutant : hasConstraint

CheckMutantsLeft --> SaveMutationScore : allTested
CheckMutantsLeft --> MeasureTestSuite : !allTested

SaveMutationScore --> Done : !resetOld
SaveMutationScore --> MeasureTestSuite : resetOld

MeasureTestSuite --> Error : unreliable
MeasureTestSuite --> Coverage : useCov
MeasureTestSuite --> LoadSchematas : !useCov

Coverage --> PropagateCov : !error
Coverage --> LoadSchematas : error
PropagateCov --> LoadSchematas

LoadSchematas --> ResetOldMutant

ResetOldMutant --> UpdateTimeout

CheckRuntime --> UpdateTimeout
CheckRuntime --> Done : runtime>max

NextPullRequestMutant --> MutationTest
NextPullRequestMutant --> Done : allTested

NextSchemata --> SchemataTest : hasSchema
NextSchemata --> Done : !hasSchema && user
NextSchemata --> NextMutant
SchemataTest --> SchemataTestResult : done
SchemataTestResult --> CheckRuntime

NextMutant --> CheckTimeout : allTested
NextMutant --> MutationTest
MutationTest --> HandleTestResult : next
MutationTest --> Error : error
MutationTest --> MutationTest

HandleTestResult --> CheckRuntime

CheckTimeout --> Done : unchanged
CheckTimeout --> UpdateTimeout : changed

Done --> SchemataPruneUsed
SchemataPruneUsed --> Stop

Error --> Stop
@enduml
